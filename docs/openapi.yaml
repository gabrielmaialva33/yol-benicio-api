openapi: 3.1.0
info:
  title: Yol Benício API
  version: 1.0.0
  description: |
    ## Welcome to Yol Benício API

    A comprehensive legal management system API built with AdonisJS v6. This API provides robust functionality for managing legal processes, clients, schedules, billing and user access control.

    ### Key Features

    - **JWT Authentication**: Secure token-based authentication with refresh tokens
    - **Role-Based Access Control**: Fine-grained permissions with multiple user roles
    - **User Management**: Complete CRUD operations for user accounts
    - **File Management**: Secure file upload with automatic categorization
    - **Health Monitoring**: Built-in health check endpoints

    ## Authentication

    The API uses JWT Bearer authentication. To access protected endpoints:

    1. **Login**: POST to `/api/v1/sessions/sign-in` with your credentials
    2. **Get Token**: Extract the `access_token` from the response
    3. **Use Token**: Include `Authorization: Bearer <token>` in all requests

    ### Token Management

    - **Access Token Lifetime**: 1 hour
    - **Refresh Token Lifetime**: 3 days
    - **Token Format**: JWT Bearer token

    ## API Conventions

    ### Request Format
    - **Content-Type**: `application/json` for all requests (except file uploads)
    - **Pagination**: Use `?page=1&per_page=10` query parameters (Users endpoints). Some admin endpoints (e.g., Roles) use `perPage`.
    - **Sorting**: Use `?sort_by=field&order=asc` or `?sort_by=field&order=desc` (Users endpoints). Some admin endpoints (e.g., Roles) use `sortBy`.
    - **Searching**: Use `?search=term` for text search

    ### Response Format
    - **Success**: HTTP 2xx with JSON body
    - **Errors**: HTTP 4xx/5xx with standardized error format
    - **Timestamps**: ISO 8601 format
    - **Database Fields**: snake_case naming convention

    ### Common Headers
    ```
    Authorization: Bearer <token>
    Content-Type: application/json
    Accept: application/json
    ```

  contact:
    name: API Support
    email: support@example.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: http://127.0.0.1:3333
    description: Local development server
  - url: https://api.yourdomain.com
    description: Production server

security:
  - bearerAuth: []

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT authentication token

  schemas:
    User:
      type: object
      properties:
        id:
          type: integer
          example: 1
        full_name:
          type: string
          example: 'John Doe'
        email:
          type: string
          format: email
          example: 'john@example.com'
        username:
          type: string
          example: 'johndoe'
        created_at:
          type: string
          format: date-time
          example: '2024-01-01T00:00:00.000Z'
        updated_at:
          type: string
          format: date-time
          example: '2024-01-01T00:00:00.000Z'
        roles:
          type: array
          items:
            $ref: '#/components/schemas/Role'

    Role:
      type: object
      properties:
        id:
          type: integer
          example: 1
        name:
          type: string
          example: 'User'
        description:
          type: string
          example: 'Regular user role'
        slug:
          type: string
          enum: [root, admin, user, guest]
          example: 'user'
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    AuthResponse:
      type: object
      properties:
        id:
          type: integer
        full_name:
          type: string
        email:
          type: string
          format: email
        username:
          type: string
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
        roles:
          type: array
          items:
            $ref: '#/components/schemas/Role'
        auth:
          type: object
          properties:
            access_token:
              type: string
              example: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...'
            refresh_token:
              type: string
              example: 'refresh_token_string'

    Error:
      type: object
      properties:
        errors:
          type: array
          items:
            type: object
            properties:
              message:
                type: string
                example: 'Validation error'
              field:
                type: string
                example: 'email'
              rule:
                type: string
                example: 'email'

    Pagination:
      type: object
      properties:
        meta:
          type: object
          properties:
            total:
              type: integer
              example: 100
            per_page:
              type: integer
              example: 10
            current_page:
              type: integer
              example: 1
            last_page:
              type: integer
              example: 10
            first_page:
              type: integer
              example: 1
            first_page_url:
              type: string
              example: '/?page=1'
            last_page_url:
              type: string
              example: '/?page=10'
            next_page_url:
              type: string
              example: '/?page=2'
            previous_page_url:
              type: string
              example: null

    FileUploadResponse:
      type: object
      properties:
        url:
          type: string
          example: 'https://storage.example.com/files/abc123.pdf'
        clientName:
          type: string
          example: 'document.pdf'
        fileCategory:
          type: string
          enum: [image, document, video, audio, file]
          example: 'document'
        fileType:
          type: string
          example: 'application/pdf'
        size:
          type: integer
          example: 12345
        extname:
          type: string
          example: 'pdf'

    # Dashboard Schemas
    DashboardActiveFolders:
      type: object
      properties:
        active:
          type: integer
          description: Number of active folders
          example: 420
        newThisMonth:
          type: integer
          description: Number of new folders created this month
          example: 98
        history:
          type: array
          description: Historical data for the last months
          items:
            type: object
            properties:
              month:
                type: string
                description: Month abbreviation
                example: 'Jan'
              value:
                type: integer
                description: Number of folders in that month
                example: 380

    DashboardAreaDivision:
      type: array
      description: Legal area division statistics
      items:
        type: object
        properties:
          name:
            type: string
            description: Area name
            example: 'Trabalhista'
          value:
            type: integer
            description: Percentage value
            example: 40
          color:
            type: string
            description: Chart color in hex format
            example: '#10B981'

    DashboardFolderActivity:
      type: array
      description: Folder activity statistics
      items:
        type: object
        properties:
          label:
            type: string
            description: Activity status label
            example: 'EM ANDAMENTO'
          value:
            type: integer
            description: Number of folders in this status
            example: 420
          color:
            type: string
            description: Chart color in hex format
            example: '#F59E0B'
          percentage:
            type: integer
            description: Percentage of total folders
            example: 50

    DashboardRequests:
      type: object
      properties:
        new:
          type: integer
          description: Number of new requests
          example: 6
        percentage:
          type: integer
          description: Growth percentage compared to previous period
          example: 62
        history:
          type: array
          description: Historical data for requests
          items:
            type: object
            properties:
              month:
                type: string
                description: Month abbreviation
                example: 'Jan'
              value:
                type: integer
                description: Number of requests in that month
                example: 17

    DashboardBilling:
      type: object
      properties:
        value:
          type: string
          description: Formatted billing value in Brazilian currency
          example: 'R$ 89.980'
        percentage:
          type: string
          description: Growth percentage as string
          example: '8.2'
        chart:
          type: array
          description: Chart data for billing visualization
          items:
            type: object
            properties:
              pv:
                type: integer
                description: Present value for chart point
                example: 80000

    DashboardHearings:
      type: array
      description: Hearings and deadlines statistics
      items:
        type: object
        properties:
          label:
            type: string
            description: Type of hearing or deadline
            example: 'Audiências'
          percentage:
            type: integer
            description: Completion percentage
            example: 75
          total:
            type: integer
            description: Total number of items
            example: 12
          completed:
            type: integer
            description: Number of completed items
            example: 9
          color:
            type: string
            description: Chart color in hex format
            example: '#10B981'
          date:
            type: string
            format: date-time
            description: Next scheduled date
            example: '2024-01-15T10:00:00.000Z'

    DashboardBirthdays:
      type: array
      description: Today's birthdays
      items:
        type: object
        properties:
          avatar:
            type: string
            format: uri
            description: Avatar URL
            example: 'https://avataaars.io/?avatarStyle=Circle&topType=ShortHairShortCurly'
          name:
            type: string
            description: Person's full name
            example: 'Maria Silva'
          email:
            type: string
            format: email
            description: Person's email address
            example: 'maria.silva@benicio.com.br'

    DashboardTasks:
      type: array
      description: Recent tasks list
      items:
        type: object
        properties:
          id:
            type: integer
            description: Task ID
            example: 1
          title:
            type: string
            description: Task title
            example: 'Agendamento do processo 7845'
          category:
            type: string
            description: Task category
            example: 'Física'
          completed:
            type: boolean
            description: Whether the task is completed
            example: true

    DashboardData:
      type: object
      description: Complete dashboard data with all widgets
      properties:
        activeFolders:
          $ref: '#/components/schemas/DashboardActiveFolders'
        areaDivision:
          $ref: '#/components/schemas/DashboardAreaDivision'
        folderActivity:
          $ref: '#/components/schemas/DashboardFolderActivity'
        requests:
          $ref: '#/components/schemas/DashboardRequests'
        billing:
          $ref: '#/components/schemas/DashboardBilling'
        hearings:
          $ref: '#/components/schemas/DashboardHearings'
        birthdays:
          $ref: '#/components/schemas/DashboardBirthdays'
        tasks:
          $ref: '#/components/schemas/DashboardTasks'

  parameters:
    pathId:
      name: id
      in: path
      required: true
      schema:
        type: integer
      description: Resource ID

    pageParam:
      name: page
      in: query
      schema:
        type: integer
        default: 1
        minimum: 1
      description: Page number for pagination

    perPageParam:
      name: perPage
      in: query
      schema:
        type: integer
        default: 10
        minimum: 1
        maximum: 100
      description: Number of items per page

    per_pageParam:
      name: per_page
      in: query
      schema:
        type: integer
        default: 10
        minimum: 1
        maximum: 100
      description: Number of items per page (snake_case)

    sort_byParam:
      name: sort_by
      in: query
      schema:
        type: string
        default: id
      description: Field to sort by (snake_case)

    orderParam:
      name: order
      in: query
      schema:
        type: string
        enum: [asc, desc]
        default: asc
      description: Sort order

    searchParam:
      name: search
      in: query
      schema:
        type: string
      description: Search term for filtering results

  responses:
    UnauthorizedError:
      description: Authentication required
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            errors:
              - message: 'Unauthorized'

    ForbiddenError:
      description: Insufficient permissions
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            errors:
              - message: 'Forbidden'

    NotFoundError:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            errors:
              - message: 'Resource not found'

    ValidationError:
      description: Validation failed
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'

    InternalServerError:
      description: Internal server error
      content:
        application/json:
          schema:
            type: object
            properties:
              message:
                type: string
                example: 'Internal server error'

tags:
  - name: Health
    description: System health monitoring endpoints
  - name: Authentication
    description: User authentication and session management
  - name: Users
    description: User management operations
  - name: Roles
    description: Role management operations (admin only)
  - name: Files
    description: File upload and management
  - name: Profile
    description: Current user profile operations
  - name: Permissions
    description: Permission management operations (admin only)
  - name: Dashboard
    description: Dashboard widgets and analytics data endpoints

paths:
  /api:
    get:
      operationId: getApiInfo
      summary: Get API information
      description: Returns basic information about the API
      tags:
        - Health
      security: []
      responses:
        '200':
          description: API information
          content:
            application/json:
              schema:
                type: object
                properties:
                  name:
                    type: string
                    example: 'yol-benicio-api'
                  description:
                    type: string
                    example: 'Yol Benício Legal Management System - API built with AdonisJS.'
                  version:
                    type: string
                    example: '0.0.1'
                  author:
                    type: string
                    example: 'Gabriel M.'
                  contributors:
                    type: array
                    items:
                      type: string
        '429':
          description: Too Many Requests
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/v1/health:
    get:
      operationId: healthCheck
      summary: Health check
      description: Check the health status of the API and its services
      tags:
        - Health
      security: []
      responses:
        '200':
          description: Service is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  healthy:
                    type: boolean
                    example: true
                  services:
                    type: object
                    properties:
                      database:
                        type: object
                        properties:
                          healthy:
                            type: boolean
                            example: true
        '429':
          description: Too Many Requests
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '503':
          description: Service unhealthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  healthy:
                    type: boolean
                    example: false
                  services:
                    type: object

  /api/dashboard:
    get:
      operationId: getDashboardData
      summary: Get complete dashboard data
      description: |
        Retrieve all dashboard widgets data in a single request. This endpoint combines all dashboard statistics including active folders, area division, folder activity, requests, billing, hearings, birthdays, and tasks.

        **Use Case**: Primary endpoint for loading the complete dashboard view with all widgets at once.

        **Performance**: Optimized with parallel data fetching using Promise.all()
      tags:
        - Dashboard
      responses:
        '200':
          description: Dashboard data retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DashboardData'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/dashboard/active-folders:
    get:
      operationId: getDashboardActiveFolders
      summary: Get active folders statistics
      description: |
        Retrieve statistics about active legal folders including current count, new folders this month, and historical data.

        **Metrics**:
        - Total active folders count
        - New folders created this month
        - Monthly history for trend analysis

        **Data Source**: Real-time data from folders table
      tags:
        - Dashboard
      responses:
        '200':
          description: Active folders statistics retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DashboardActiveFolders'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/dashboard/area-division:
    get:
      operationId: getDashboardAreaDivision
      summary: Get legal area division statistics
      description: |
        Retrieve the distribution of legal cases across different practice areas.

        **Areas Covered**:
        - Trabalhista (Labor Law)
        - Penal (Criminal Law)
        - Cível (Civil Law)
        - Cível Contencioso (Civil Litigation)

        **Data Source**: Materialized view `vw_dashboard_area_division`
      tags:
        - Dashboard
      responses:
        '200':
          description: Area division statistics retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DashboardAreaDivision'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/dashboard/folder-activity:
    get:
      operationId: getDashboardFolderActivity
      summary: Get folder activity statistics
      description: |
        Retrieve statistics about folder status distribution and activity levels.

        **Status Categories**:
        - EM ANDAMENTO (In Progress)
        - ATRASADAS (Delayed)
        - SOLUCIONADAS (Resolved)

        **Data Source**: Materialized view `mv_dashboard_folder_activity`
      tags:
        - Dashboard
      responses:
        '200':
          description: Folder activity statistics retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DashboardFolderActivity'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/dashboard/requests:
    get:
      operationId: getDashboardRequests
      summary: Get requests statistics
      description: |
        Retrieve statistics about client requests and service inquiries.

        **Metrics**:
        - New requests count
        - Growth percentage compared to previous period
        - Monthly history for trend analysis

        **Data Source**: Materialized view `mv_dashboard_requests`
      tags:
        - Dashboard
      responses:
        '200':
          description: Requests statistics retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DashboardRequests'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/dashboard/billing:
    get:
      operationId: getDashboardBilling
      summary: Get billing statistics
      description: |
        Retrieve financial and billing statistics including revenue totals and growth metrics.

        **Metrics**:
        - Current period total billing
        - Growth percentage
        - Historical chart data for trend visualization

        **Currency**: Values formatted in Brazilian Real (R$)
        **Data Source**: Materialized view `mv_dashboard_billing`
      tags:
        - Dashboard
      responses:
        '200':
          description: Billing statistics retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DashboardBilling'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/dashboard/hearings:
    get:
      operationId: getDashboardHearings
      summary: Get hearings and deadlines statistics
      description: |
        Retrieve statistics about upcoming hearings and legal deadlines.

        **Categories**:
        - Audiências (Court Hearings)
        - Prazos processuais (Procedural Deadlines)
        - Prazos administrativos (Administrative Deadlines)

        **Metrics**: Completion percentages, totals, and next scheduled dates
      tags:
        - Dashboard
      responses:
        '200':
          description: Hearings statistics retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DashboardHearings'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/dashboard/birthdays:
    get:
      operationId: getDashboardBirthdays
      summary: Get today's birthdays
      description: |
        Retrieve a list of team members and clients celebrating birthdays today.

        **Purpose**: Team engagement and client relationship management
        **Data**: Avatar, name, and email for each birthday person
        **Update Frequency**: Daily
      tags:
        - Dashboard
      responses:
        '200':
          description: Today's birthdays retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DashboardBirthdays'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/dashboard/tasks:
    get:
      operationId: getDashboardTasks
      summary: Get tasks statistics
      description: |
        Retrieve recent tasks and task completion statistics for dashboard display.

        **Data**: List of most recent tasks with completion status
        **Limit**: 5 most recent tasks
        **Source**: Real-time data from tasks table with fallback to reference data
        **Task States**: Completed/Incomplete status tracking
      tags:
        - Dashboard
      responses:
        '200':
          description: Tasks statistics retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DashboardTasks'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/v1/sessions/sign-in:
    post:
      operationId: signIn
      summary: User login
      description: Authenticate a user and receive JWT tokens
      tags:
        - Authentication
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - uid
                - password
              properties:
                uid:
                  type: string
                  description: Email or username
                  example: 'john@example.com'
                password:
                  type: string
                  format: password
                  minLength: 6
                  example: 'password123'
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '401':
          description: Invalid credentials
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                errors:
                  - message: 'Invalid credentials'
        '422':
          $ref: '#/components/responses/ValidationError'

  /api/v1/me:
    get:
      operationId: getProfile
      summary: Get current user profile
      description: Retrieve the profile of the currently authenticated user
      tags:
        - Profile
      responses:
        '200':
          description: Profile retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/v1/me/permissions:
    get:
      operationId: getMyPermissions
      summary: Get current user permissions
      description: Retrieve the permissions of the currently authenticated user
      tags:
        - Profile
      responses:
        '200':
          description: Permissions retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  permissions:
                    type: array
                    items:
                      type: string
                      example: 'users.create'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/v1/me/roles:
    get:
      operationId: getMyRoles
      summary: Get current user roles
      description: Retrieve the roles of the currently authenticated user
      tags:
        - Profile
      responses:
        '200':
          description: Roles retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  roles:
                    type: array
                    items:
                      $ref: '#/components/schemas/Role'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/v1/sessions/sign-up:
    post:
      operationId: signUp
      summary: User registration
      description: Create a new user account
      tags:
        - Authentication
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - full_name
                - email
                - password
                - password_confirmation
              properties:
                full_name:
                  type: string
                  example: 'John Doe'
                email:
                  type: string
                  format: email
                  example: 'john@example.com'
                username:
                  type: string
                  example: 'johndoe'
                  description: Optional username
                password:
                  type: string
                  format: password
                  minLength: 6
                  example: 'password123'
                password_confirmation:
                  type: string
                  format: password
                  example: 'password123'
      responses:
        '201':
          description: Registration successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '422':
          $ref: '#/components/responses/ValidationError'

  /api/v1/verify-email:
    get:
      operationId: verifyEmail
      summary: Verify user email
      description: Verify a user's email address using a token from the verification link.
      tags:
        - Authentication
      security: []
      parameters:
        - name: token
          in: query
          required: true
          schema:
            type: string
          description: The email verification token
      responses:
        '200':
          description: Email verified successfully
        '400':
          description: Invalid or expired token

  /api/v1/resend-verification-email:
    post:
      operationId: resendVerificationEmail
      summary: Resend verification email
      description: Resends the email verification link to the authenticated user.
      tags:
        - Authentication
      responses:
        '200':
          description: Verification email sent successfully
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/v1/users:
    get:
      operationId: listUsers
      summary: List users
      description: Get a paginated list of users with optional search and sorting
      tags:
        - Users
      parameters:
        - $ref: '#/components/parameters/pageParam'
        - $ref: '#/components/parameters/per_pageParam'
        - $ref: '#/components/parameters/sort_byParam'
        - $ref: '#/components/parameters/orderParam'
        - $ref: '#/components/parameters/searchParam'
      responses:
        '200':
          description: User list retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/Pagination'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: '#/components/schemas/User'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

    post:
      operationId: createUser
      summary: Create user
      description: Create a new user account (requires USER role)
      tags:
        - Users
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - full_name
                - email
                - password
                - password_confirmation
              properties:
                full_name:
                  type: string
                email:
                  type: string
                  format: email
                username:
                  type: string
                password:
                  type: string
                  format: password
                  minLength: 6
                password_confirmation:
                  type: string
                  format: password
      responses:
        '201':
          description: User created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '422':
          $ref: '#/components/responses/ValidationError'

  /api/v1/users/{id}:
    get:
      operationId: getUserById
      summary: Get user by ID
      description: Retrieve a specific user's details
      tags:
        - Users
      parameters:
        - $ref: '#/components/parameters/pathId'
      responses:
        '200':
          description: User details retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'

    put:
      operationId: updateUser
      summary: Update user
      description: Update user details (email and username cannot be changed)
      tags:
        - Users
      parameters:
        - $ref: '#/components/parameters/pathId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                full_name:
                  type: string
                password:
                  type: string
                  format: password
                  minLength: 6
                password_confirmation:
                  type: string
                  format: password
                  description: Required if password is provided
      responses:
        '200':
          description: User updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '422':
          $ref: '#/components/responses/ValidationError'

    delete:
      operationId: deleteUser
      summary: Delete user
      description: Soft delete a user (marks as deleted)
      tags:
        - Users
      parameters:
        - $ref: '#/components/parameters/pathId'
      responses:
        '204':
          description: User deleted successfully
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'

  /api/v1/admin/roles:
    get:
      operationId: listRoles
      summary: List roles
      description: Get a paginated list of roles (requires ADMIN or ROOT role)
      tags:
        - Roles
      parameters:
        - $ref: '#/components/parameters/pageParam'
        - $ref: '#/components/parameters/perPageParam'
      responses:
        '200':
          description: Role list retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/Pagination'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: '#/components/schemas/Role'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'

  /api/v1/admin/roles/attach:
    put:
      operationId: attachRoles
      summary: Attach roles to user
      description: Assign roles to a user (requires ADMIN or ROOT role)
      tags:
        - Roles
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - user_id
                - role_ids
              properties:
                user_id:
                  type: integer
                  example: 1
                role_ids:
                  type: array
                  items:
                    type: integer
                  example: [1, 2, 3]
      responses:
        '200':
          description: Roles attached successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: 'Role attached successfully'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '422':
          $ref: '#/components/responses/ValidationError'

  /api/v1/admin/permissions:
    get:
      operationId: listPermissions
      summary: List permissions
      description: Get a paginated list of permissions
      tags:
        - Permissions
      parameters:
        - $ref: '#/components/parameters/pageParam'
        - $ref: '#/components/parameters/perPageParam'
        - in: query
          name: resource
          schema:
            type: string
          description: Filter by resource
        - in: query
          name: action
          schema:
            type: string
          description: Filter by action
      responses:
        '200':
          description: Permission list retrieved successfully
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
    post:
      operationId: createPermission
      summary: Create permission
      description: Create a new permission
      tags:
        - Permissions
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - resource
                - action
              properties:
                resource:
                  type: string
                  example: 'posts'
                action:
                  type: string
                  example: 'create'
                description:
                  type: string
                  example: 'Allow creating posts'
      responses:
        '201':
          description: Permission created successfully
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '422':
          $ref: '#/components/responses/ValidationError'

  /api/v1/admin/roles/permissions/sync:
    put:
      operationId: syncRolePermissions
      summary: Sync role permissions
      description: Sync all permissions for a specific role
      tags:
        - Permissions
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - role_id
                - permission_ids
              properties:
                role_id:
                  type: integer
                  example: 2
                permission_ids:
                  type: array
                  items:
                    type: integer
                  example: [1, 2, 3]
      responses:
        '200':
          description: Permissions synced successfully
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '422':
          $ref: '#/components/responses/ValidationError'

  /api/v1/admin/roles/permissions/attach:
    put:
      operationId: attachRolePermissions
      summary: Attach permissions to role
      description: Attach one or more permissions to a role
      tags:
        - Permissions
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - role_id
                - permission_ids
              properties:
                role_id:
                  type: integer
                  example: 2
                permission_ids:
                  type: array
                  items:
                    type: integer
                  example: [4, 5]
      responses:
        '200':
          description: Permissions attached successfully
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '422':
          $ref: '#/components/responses/ValidationError'

  /api/v1/admin/roles/permissions/detach:
    put:
      operationId: detachRolePermissions
      summary: Detach permissions from role
      description: Detach one or more permissions from a role
      tags:
        - Permissions
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - role_id
                - permission_ids
              properties:
                role_id:
                  type: integer
                  example: 2
                permission_ids:
                  type: array
                  items:
                    type: integer
                  example: [1]
      responses:
        '200':
          description: Permissions detached successfully
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '422':
          $ref: '#/components/responses/ValidationError'

  /api/v1/admin/users/permissions/sync:
    put:
      operationId: syncUserPermissions
      summary: Sync user permissions
      description: Sync all direct permissions for a specific user
      tags:
        - Permissions
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - user_id
                - permissions
              properties:
                user_id:
                  type: integer
                  example: 3
                permissions:
                  type: array
                  items:
                    type: object
                    properties:
                      permission_id:
                        type: integer
                        example: 10
                      granted:
                        type: boolean
                        example: true
                      expires_at:
                        type: [string, 'null']
                        example: '2025-12-31T23:59:59.000Z'
      responses:
        '200':
          description: User permissions synced successfully
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '422':
          $ref: '#/components/responses/ValidationError'

  /api/v1/admin/users/{id}/permissions:
    get:
      operationId: getUserPermissions
      summary: Get user's direct permissions
      description: Get a list of direct permissions for a specific user
      tags:
        - Permissions
      parameters:
        - $ref: '#/components/parameters/pathId'
      responses:
        '200':
          description: User permissions retrieved successfully
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'

  /api/v1/admin/users/{id}/permissions/check:
    post:
      operationId: checkUserPermissions
      summary: Check user permissions
      description: Check if a user has specific permissions
      tags:
        - Permissions
      parameters:
        - $ref: '#/components/parameters/pathId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - permissions
              properties:
                permissions:
                  type: array
                  items:
                    type: string
                  example: ['users.create', 'files.delete']
                require_all:
                  type: boolean
                  description: If true, user must have all permissions
                  example: false
      responses:
        '200':
          description: Check result
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '422':
          $ref: '#/components/responses/ValidationError'

  /api/v1/files/upload:
    post:
      operationId: uploadFile
      summary: Upload file
      description: |
        Upload a file to the server. Files are automatically categorized based on their type.

        **File constraints:**
        - Maximum size: 5MB
        - Allowed extensions: jpeg, jpg, png, pdf, doc, docx, txt, csv, xls, xlsx, mp3, mp4, zip

        **Categories:**
        - `image`: jpeg, jpg, png
        - `document`: pdf, doc, docx, txt
        - `video`: mp4
        - `audio`: mp3
        - `file`: csv, xls, xlsx, zip, and others
      tags:
        - Files
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - file
              properties:
                file:
                  type: string
                  format: binary
                  description: File to upload
      responses:
        '201':
          description: File uploaded successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FileUploadResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '422':
          description: File validation failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                errors:
                  - message: 'File size should be less than 5MB'
                    field: 'file'
                    rule: 'size'
